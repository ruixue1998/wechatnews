name: wechatnews

on:
  schedule:
    # 每天北京时间早上 8 点运行
    - cron: '0 0 * * *'
  # 允许手动触发
  workflow_dispatch:

jobs:
  fetch_article:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Fetch latest article
        id: fetch
        env:
          # ↓↓↓ 确保这里是你自己的 __biz 值 ↓↓↓
          BIZ: 'MjM5MjAyNDUyMA=='
        # 使用 python -u 来运行，确保日志实时输出
        run: |
          python -u -c "
          import os
          import requests
          import json
          import sys

          biz = os.environ.get('BIZ')
          url = f'https://weread.111965.xyz/api/v1/feeds/articles/{biz}?recent=1'

          try:
            # 设置60秒超时
            response = requests.get(url, timeout=60)
            # 如果状态码不是 200-299，则抛出异常
            response.raise_for_status()
            data = response.json()

            if data and 'items' in data and data['items']:
              latest_article = data['items'][0]
              title = latest_article.get('title', 'No Title')
              link = latest_article.get('url', 'No URL')
              print(f\"公众号: {data.get('title', 'Unknown')}\")
              print(f'最新文章标题: {title}')
              print(f'最新文章链接: {link}')
              # 将输出写入 GITHUB_OUTPUT
              with open(os.environ['GITHUB_OUTPUT'], 'a') as f:
                  print(f'article_title={title}', file=f)
                  print(f'article_link={link}', file=f)
            else:
              print('未能获取到文章，API返回数据为空或格式不符。')

          except requests.exceptions.RequestException as e:
            print(f'网络或HTTP请求错误: {e}', file=sys.stderr)
            sys.exit(1)
          except Exception as e:
            print(f'发生未知错误: {e}', file=sys.stderr)
            sys.exit(1)
          "
---

### **后续步骤**

1.  用上面的代码**完整替换** `wechatnews.yml` 的内容。
2.  **保存并提交** (Commit changes)。
3.  回到 **“Actions”** 标签页，**手动运行一次**。

如果这次还是失败，请像刚才一样，把日志里 **`网络或HTTP请求错误:`** 或 **`发生未知错误:`** 后面的那段英文告诉我。但我相信，多试几次总会有一次成功的！
